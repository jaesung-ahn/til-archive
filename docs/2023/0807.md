# 0807 ~ 0902

## 0808 - Spring Boot 설정에 따른 동적 빈 생성
스케줄러를 조건부로 등록하기 위해 학습

### 1. @Value boolean
@Value를 통해 properties 값을 주입 받아 처리(동적 빈등록이랑은 무관)
```java
@Configuration
@EnableScheduling
public class ScheduledJobs {
  @Value("${jobs.enabled:true}")
  private boolean isEnabled;

  @Scheduled(fixedDelay = 60000)
  public void cleanTempDirectory() {
    if(isEnabled) {
      // do work here
    }
  }
}
```

### 2. @ConditionalOnProperty
```java
@Configuration
@EnableScheduling
public class ScheduledJobs {
    @Bean
    @ConditionalOnProperty(value = "jobs.enabled", matchIfMissing = true, havingValue = "true")
    public ScheduledJob scheduledJob() {
        return new ScheduledJob();
    }
}
```

### 3. @Profile 
```java
@Profile("prod") // or @Profile("!prod")
@Bean
public ScheduledJob scheduledJob() {
    return new ScheduledJob();
}
```

### 4. @Conditional
@Profile 은 내부적으로 @Conditional을 사용
```java
public class CustomCondition implements Condition {
    @Override
    public boolean matches(ConditionContext context, AnnotatedTypeMetadata metadata) {
        String property = context.getEnvironment().getProperty("jobs.enabled");
        return "prod".equals(property);
    }
}
```
- property에 "jobs.enabled"의 key가 "prod"이라면 빈 등록

```java
@Conditional(CustomCondition.class)
@Bean
public ScheduledJob scheduledJob() {
    return new ScheduledJob();
}
```

<br>

## 0829 - Load Average
#### Load Average란
Load Average란 얼마나 많은 프로세스가 실행 중 혹은 실행 대기중인지 의미하는 수치이다. 조금더 자세히 말해 프로세스 상태 중에서 R(Running)과 D(Uninterruptible waiting)상태 프로세스 개수를 1분, 5분, 15분마다 평균낸 값을 말한다. 즉, 시스템의 부하를 평균치로 알려주는 값이다. 일반적으로 1분 값보다는 5분, 15분의 값을 많이 사용한다.

#### 프로세스 상태 R(Running)이란?
- CPU에서 수행이되고 있거나 실행가능한 상태를 말한다.

#### 프로세스 상태 D(Uninterruptible waiting)이란?
- I/O에 대해 대기하는 상태로 다른 어떤일도 할 수 없음을 의미한다.

#### Load Average 확인 명령어
- Load Average는 `uptime` 명령어로 확인 가능하며 이는 /proc/loadavg 파일을 열어서 그 파일의 내용을 읽고 화면에 출력해주는 명령어이다. Load Average 값을 직접 계산하는것은 아니고 커널이 미리 준비해둔 /proc/loadavg 파일을 읽어서 보여주는 명령어이다.
- `uptime` 뿐만아니라 `top`, `cat /proc/loadavg` 으로 확인 가능하다.
- `uptime` command
```
$ uptime 10:23:10 up 3 days, 12:06, 1 user, load average: 1.41, 1.37, 1.35
```
- 첫번째 값 : 1분 동안의 평균값
- 두번째 값 : 5분 동안의 평균값
- 세번째 값 : 15분 동안의 평균값

#### Load Average 값의 의미
- Load Average 값은 CPU의 코어수에 따라서 숫자가 달라지며 각 CPU 코어가 100% Load가 발생할 경우, 1코어는 값 1, 2코어는 2, 4코어는 값 4로 표현이 된다. 만약 Load Average가 4라면, 시스템이 CPU 코어 4개를 100% 사용하고 있거나, CPU 코어 1개를 400% 사용하고 있다는 의미이다.
- 시스템 운영시 권장하는 에버리지는 70%인 0.7 이하이며 그 이상일 경우 시스템에 이상이 없는지 반드시 체크해야 한다.

<br>

## 0831 - AWS Service
### AWS 서비스 정리

| 서비스 명 | 설명 |
| --------- | ---- |
|           |      |