# 0807 ~ 0813

## 0808 - Spring Boot 설정에 따른 동적 빈 생성
스케줄러를 조건부로 등록하기 위해 학습

### 1. @Value boolean
@Value를 통해 properties 값을 주입 받아 처리(동적 빈등록이랑은 무관)
```java
@Configuration
@EnableScheduling
public class ScheduledJobs {
  @Value("${jobs.enabled:true}")
  private boolean isEnabled;

  @Scheduled(fixedDelay = 60000)
  public void cleanTempDirectory() {
    if(isEnabled) {
      // do work here
    }
  }
}
```

### 2. @ConditionalOnProperty
```java
@Configuration
@EnableScheduling
public class ScheduledJobs {
    @Bean
    @ConditionalOnProperty(value = "jobs.enabled", matchIfMissing = true, havingValue = "true")
    public ScheduledJob scheduledJob() {
        return new ScheduledJob();
    }
}
```

### 3. @Profile 
```java
@Profile("prod") // or @Profile("!prod")
@Bean
public ScheduledJob scheduledJob() {
    return new ScheduledJob();
}
```

### 4. @Conditional
@Profile 은 내부적으로 @Conditional을 사용
```java
public class CustomCondition implements Condition {
    @Override
    public boolean matches(ConditionContext context, AnnotatedTypeMetadata metadata) {
        String property = context.getEnvironment().getProperty("jobs.enabled");
        return "prod".equals(property);
    }
}
```
- property에 "jobs.enabled"의 key가 "prod"이라면 빈 등록

```java
@Conditional(CustomCondition.class)
@Bean
public ScheduledJob scheduledJob() {
    return new ScheduledJob();
}
```

<br>