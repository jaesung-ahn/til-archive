<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>1220 - 1226 | TIL</title>
    <meta name="generator" content="VuePress 1.8.0">
    
    <meta name="description" content="
1221 - 전략패턴과 커맨드패턴
인터페이스를 구현하여 사용하는 두 가지 패턴인 전략 패턴과 커맨드 패턴의 차이
전략패턴
전략 패턴은 프로그램이 진행되면서 캡슐화된 로직을 선택할 수 있게 하는 디자인 패턴이다. 로직 실행은 인터페이스에 의존을 시키고 인터페이스를 구현한 로직들을 전달해줌으로써 분기처리 없이 유연서을 갖출 수가 있다.

예 ...">
    
    <link rel="preload" href="/TIL/assets/css/0.styles.9729072d.css" as="style"><link rel="preload" href="/TIL/assets/js/app.face42bf.js" as="script"><link rel="preload" href="/TIL/assets/js/6.5d7ec74f.js" as="script"><link rel="preload" href="/TIL/assets/js/11.eca71194.js" as="script"><link rel="preload" href="/TIL/assets/js/51.c3bdfcaa.js" as="script"><link rel="prefetch" href="/TIL/assets/js/10.5c95ce33.js"><link rel="prefetch" href="/TIL/assets/js/12.44862a55.js"><link rel="prefetch" href="/TIL/assets/js/13.3354667d.js"><link rel="prefetch" href="/TIL/assets/js/14.ebd32721.js"><link rel="prefetch" href="/TIL/assets/js/15.9a5da76a.js"><link rel="prefetch" href="/TIL/assets/js/16.0ec9d5c5.js"><link rel="prefetch" href="/TIL/assets/js/17.197aed0f.js"><link rel="prefetch" href="/TIL/assets/js/18.ac1d8f71.js"><link rel="prefetch" href="/TIL/assets/js/19.52554e37.js"><link rel="prefetch" href="/TIL/assets/js/20.d49a3176.js"><link rel="prefetch" href="/TIL/assets/js/21.703e3b5b.js"><link rel="prefetch" href="/TIL/assets/js/22.b15b40cf.js"><link rel="prefetch" href="/TIL/assets/js/23.f660074b.js"><link rel="prefetch" href="/TIL/assets/js/24.7cae7b6d.js"><link rel="prefetch" href="/TIL/assets/js/25.4544b20e.js"><link rel="prefetch" href="/TIL/assets/js/26.1b3a0d64.js"><link rel="prefetch" href="/TIL/assets/js/27.ef321cf3.js"><link rel="prefetch" href="/TIL/assets/js/28.6559ba71.js"><link rel="prefetch" href="/TIL/assets/js/29.724725e7.js"><link rel="prefetch" href="/TIL/assets/js/3.70c77cf4.js"><link rel="prefetch" href="/TIL/assets/js/30.a52d1089.js"><link rel="prefetch" href="/TIL/assets/js/31.198eeb03.js"><link rel="prefetch" href="/TIL/assets/js/32.1c678662.js"><link rel="prefetch" href="/TIL/assets/js/33.f3411971.js"><link rel="prefetch" href="/TIL/assets/js/34.92db02e4.js"><link rel="prefetch" href="/TIL/assets/js/35.e45ae628.js"><link rel="prefetch" href="/TIL/assets/js/36.454a23c3.js"><link rel="prefetch" href="/TIL/assets/js/37.0853aeff.js"><link rel="prefetch" href="/TIL/assets/js/38.f4787dfc.js"><link rel="prefetch" href="/TIL/assets/js/39.fa931ac4.js"><link rel="prefetch" href="/TIL/assets/js/4.851786b4.js"><link rel="prefetch" href="/TIL/assets/js/40.2f2b7cc1.js"><link rel="prefetch" href="/TIL/assets/js/41.af69bea0.js"><link rel="prefetch" href="/TIL/assets/js/42.266b80d2.js"><link rel="prefetch" href="/TIL/assets/js/43.9eca0436.js"><link rel="prefetch" href="/TIL/assets/js/44.3c9dd560.js"><link rel="prefetch" href="/TIL/assets/js/45.839c0213.js"><link rel="prefetch" href="/TIL/assets/js/46.44355db1.js"><link rel="prefetch" href="/TIL/assets/js/47.fb2d1489.js"><link rel="prefetch" href="/TIL/assets/js/48.117f6110.js"><link rel="prefetch" href="/TIL/assets/js/49.f5f58c80.js"><link rel="prefetch" href="/TIL/assets/js/5.a40fa64b.js"><link rel="prefetch" href="/TIL/assets/js/50.bf663577.js"><link rel="prefetch" href="/TIL/assets/js/52.5a372c16.js"><link rel="prefetch" href="/TIL/assets/js/53.796d7943.js"><link rel="prefetch" href="/TIL/assets/js/54.c46aa092.js"><link rel="prefetch" href="/TIL/assets/js/55.3e3ec3b1.js"><link rel="prefetch" href="/TIL/assets/js/56.e7675ae5.js"><link rel="prefetch" href="/TIL/assets/js/57.7e5b274a.js"><link rel="prefetch" href="/TIL/assets/js/58.8674754f.js"><link rel="prefetch" href="/TIL/assets/js/59.b922d1c3.js"><link rel="prefetch" href="/TIL/assets/js/60.7ce728db.js"><link rel="prefetch" href="/TIL/assets/js/61.e69f607b.js"><link rel="prefetch" href="/TIL/assets/js/62.f6f4222a.js"><link rel="prefetch" href="/TIL/assets/js/63.e9323ce2.js"><link rel="prefetch" href="/TIL/assets/js/64.d0c85d08.js"><link rel="prefetch" href="/TIL/assets/js/65.a9819011.js"><link rel="prefetch" href="/TIL/assets/js/66.c87d09bc.js"><link rel="prefetch" href="/TIL/assets/js/67.7ca58cbd.js"><link rel="prefetch" href="/TIL/assets/js/68.321ea5a8.js"><link rel="prefetch" href="/TIL/assets/js/69.a7741122.js"><link rel="prefetch" href="/TIL/assets/js/7.fda50c33.js"><link rel="prefetch" href="/TIL/assets/js/70.bdeee399.js"><link rel="prefetch" href="/TIL/assets/js/71.f312da68.js"><link rel="prefetch" href="/TIL/assets/js/72.91f45247.js"><link rel="prefetch" href="/TIL/assets/js/73.88953b79.js"><link rel="prefetch" href="/TIL/assets/js/74.d1611c1b.js"><link rel="prefetch" href="/TIL/assets/js/75.37f9e0f8.js"><link rel="prefetch" href="/TIL/assets/js/76.dc32c379.js"><link rel="prefetch" href="/TIL/assets/js/77.5433e0a6.js"><link rel="prefetch" href="/TIL/assets/js/78.6fda6ca0.js"><link rel="prefetch" href="/TIL/assets/js/79.3e50b7b1.js"><link rel="prefetch" href="/TIL/assets/js/8.584bc921.js"><link rel="prefetch" href="/TIL/assets/js/80.18405258.js"><link rel="prefetch" href="/TIL/assets/js/81.e4ccf68a.js"><link rel="prefetch" href="/TIL/assets/js/82.6b7c1912.js"><link rel="prefetch" href="/TIL/assets/js/83.34d29caa.js"><link rel="prefetch" href="/TIL/assets/js/84.ee39d9de.js"><link rel="prefetch" href="/TIL/assets/js/85.1184af6c.js"><link rel="prefetch" href="/TIL/assets/js/86.138caca8.js"><link rel="prefetch" href="/TIL/assets/js/87.038c2438.js"><link rel="prefetch" href="/TIL/assets/js/9.ad0ae255.js"><link rel="prefetch" href="/TIL/assets/js/vuejs-paginate.e9164293.js">
    <link rel="stylesheet" href="/TIL/assets/css/0.styles.9729072d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="vuepress-theme-blog__global-layout"><section id="header-wrapper"><header id="header"><div class="header-wrapper"><div class="title"><a href="/TIL/" class="nav-link home-link">TIL </a></div> <div class="header-right-wrap"><ul class="nav"><li class="nav-item"><a href="https://github.com/jaesungahn91" target="_blank" rel="noopener noreferrer" class="nav-link external">GitHub</a></li><li class="nav-item"><a href="https://velog.io/@ahnjs" target="_blank" rel="noopener noreferrer" class="nav-link external">Blog</a></li></ul> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></div></header></section> <div id="mobile-header"><div class="mobile-header-bar"><div class="mobile-header-title"><a href="/TIL/" class="nav-link mobile-home-link">TIL </a> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></div> <div class="mobile-menu-wrapper"><hr class="menu-divider"> <ul class="mobile-nav"><li class="mobile-nav-item"><a href="https://github.com/jaesungahn91" target="_blank" rel="noopener noreferrer" class="nav-link external">GitHub</a></li><li class="mobile-nav-item"><a href="https://velog.io/@ahnjs" target="_blank" rel="noopener noreferrer" class="nav-link external">Blog</a></li> <li class="mobile-nav-item"><!----></li></ul></div></div></div> <div class="content-wrapper"><div><div class="content__default"><h1 id="_1220-1226"><a href="#_1220-1226" class="header-anchor">#</a> 1220 - 1226</h1> <h2 id="_1221-전략패턴과-커맨드패턴"><a href="#_1221-전략패턴과-커맨드패턴" class="header-anchor">#</a> 1221 - 전략패턴과 커맨드패턴</h2> <p>인터페이스를 구현하여 사용하는 두 가지 패턴인 전략 패턴과 커맨드 패턴의 차이</p> <h3 id="전략패턴"><a href="#전략패턴" class="header-anchor">#</a> 전략패턴</h3> <p>전략 패턴은 프로그램이 진행되면서 캡슐화된 로직을 선택할 수 있게 하는 디자인 패턴이다. 로직 실행은 인터페이스에 의존을 시키고 인터페이스를 구현한 로직들을 전달해줌으로써 분기처리 없이 유연서을 갖출 수가 있다.</p> <ul><li>예제 코드</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PeopleWithMovement</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">Transportation</span> transportation<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">PeopleWithMovement</span><span class="token punctuation">(</span><span class="token class-name">Transportation</span> transportation<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>transportation <span class="token operator">=</span> transportation<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">move</span><span class="token punctuation">(</span><span class="token class-name">String</span> start<span class="token punctuation">,</span> <span class="token class-name">String</span> end<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        transportation<span class="token punctuation">.</span><span class="token function">move</span><span class="token punctuation">(</span>start<span class="token punctuation">,</span> end<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">changeTransporation</span><span class="token punctuation">(</span><span class="token class-name">Transportation</span> transportation<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>transportation <span class="token operator">=</span> transportation<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>전략을 행항 주체인 Transporation은 인터페이스로 분리되어 캡슐화 되어 있다.</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Transportation</span> <span class="token punctuation">{</span>

    <span class="token keyword">void</span> <span class="token function">move</span><span class="token punctuation">(</span><span class="token class-name">String</span> start<span class="token punctuation">,</span> <span class="token class-name">String</span> end<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// </span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Bicycle</span> <span class="token keyword">implements</span> <span class="token class-name">Transportation</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">move</span><span class="token punctuation">(</span><span class="token class-name">String</span> start<span class="token punctuation">,</span> <span class="token class-name">String</span> end<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;출발점 : &quot;</span> <span class="token operator">+</span> start <span class="token operator">+</span> <span class="token string">&quot;에서 목적지 : &quot;</span> <span class="token operator">+</span> end <span class="token operator">+</span> <span class="token string">&quot;까지 `자전거`로 이동합니다.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// </span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Bus</span> <span class="token keyword">implements</span> <span class="token class-name">Transportation</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">move</span><span class="token punctuation">(</span><span class="token class-name">String</span> start<span class="token punctuation">,</span> <span class="token class-name">String</span> end<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;출발점 : &quot;</span> <span class="token operator">+</span> start <span class="token operator">+</span> <span class="token string">&quot;에서 목적지 : &quot;</span> <span class="token operator">+</span> end <span class="token operator">+</span> <span class="token string">&quot;까지 `버스`로 이동합니다.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Transporation을 구현하여 Bus와 Bicycle 코드 작성</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Bicycle</span> bicycle <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Bicycle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Bus</span> bus <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Bus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">PeopleWithMovement</span> whybeFirst <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PeopleWithMovement</span><span class="token punctuation">(</span>bicycle<span class="token punctuation">)</span><span class="token punctuation">;</span>
        whybeFirst<span class="token punctuation">.</span><span class="token function">move</span><span class="token punctuation">(</span><span class="token string">&quot;시작점&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;끝점&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">PeopleWithMovement</span> whybeSecond <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PeopleWithMovement</span><span class="token punctuation">(</span>bus<span class="token punctuation">)</span><span class="token punctuation">;</span>
        whybeSecond<span class="token punctuation">.</span><span class="token function">move</span><span class="token punctuation">(</span><span class="token string">&quot;시작점&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;끝점&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">PeopleWithMovement</span> whybeChangeMovement <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PeopleWithMovement</span><span class="token punctuation">(</span>bicycle<span class="token punctuation">)</span><span class="token punctuation">;</span>
        whybeChangeMovement<span class="token punctuation">.</span><span class="token function">move</span><span class="token punctuation">(</span><span class="token string">&quot;시작점&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;중간지점&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        whybeChangeMovement<span class="token punctuation">.</span><span class="token function">changeTransporation</span><span class="token punctuation">(</span>bus<span class="token punctuation">)</span><span class="token punctuation">;</span>
        whybeChangeMovement<span class="token punctuation">.</span><span class="token function">move</span><span class="token punctuation">(</span><span class="token string">&quot;중간지점&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;끝점&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>실행 결과</p> <div class="language-java extra-class"><pre class="language-java"><code>출발점 <span class="token operator">:</span> 시작점에서 목적지 <span class="token operator">:</span> 끝점까지 `자전거`로 이동합니다<span class="token punctuation">.</span>
출발점 <span class="token operator">:</span> 시작점에서 목적지 <span class="token operator">:</span> 끝점까지 `버스`로 이동합니다<span class="token punctuation">.</span>
출발점 <span class="token operator">:</span> 시작점에서 목적지 <span class="token operator">:</span> 중간지점까지 `자전거`로 이동합니다<span class="token punctuation">.</span>
출발점 <span class="token operator">:</span> 중간지점에서 목적지 <span class="token operator">:</span> 끝점까지 `버스`로 이동합니다<span class="token punctuation">.</span>
</code></pre></div><h3 id="커맨드-패턴"><a href="#커맨드-패턴" class="header-anchor">#</a> 커맨드 패턴</h3> <p>커맨드 패턴은 요청을 홀로 처리할 수 있도록 요청을 수행하는 여러 인자를 함께 패키징하여 나중에 처리할 수 있도록 만들어주는 행동 중심 디자인 패턴이다. 커맨드를 실행시키는 객체는 커맨드 내부의 요소에 대해서 숨김으로써 코드의 유연성을 가질 수 있다.</p> <ul><li>예제 코드</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PeopleWithLottery</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">LotteryCommand</span><span class="token punctuation">&gt;</span></span> lotteryCommands<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">PeopleWithLottery</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">LotteryCommand</span><span class="token punctuation">&gt;</span></span> lotteryCommands<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>lotteryCommands <span class="token operator">=</span> lotteryCommands<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addLotteryCommand</span><span class="token punctuation">(</span><span class="token class-name">LotteryCommand</span> lotteryCommand<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        lotteryCommands<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>lotteryCommand<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">scratchAllLottery</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> lotteryCommands<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">LotteryCommand</span> lotteryCommand <span class="token operator">=</span> lotteryCommands<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            lotteryCommand<span class="token punctuation">.</span><span class="token function">scratch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//초기화</span>
        lotteryCommands <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">LotteryCommand</span> <span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token function">scratch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">InstantScratch</span> <span class="token keyword">implements</span> <span class="token class-name">LotteryCommand</span> <span class="token punctuation">{</span>
    
    <span class="token keyword">private</span> <span class="token class-name">InstantLottery</span> instantLottery<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Account</span> account<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">InstantScratch</span><span class="token punctuation">(</span><span class="token class-name">InstantLottery</span> instantLottery<span class="token punctuation">,</span> <span class="token class-name">Account</span> account<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>instantLottery <span class="token operator">=</span> instantLottery<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>account <span class="token operator">=</span> <span class="token class-name">Account</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">scratch</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">//instantLottery의 당첨을 확인하고 account에 돈을 집어 넣는 로직</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">InstantLottery</span> <span class="token punctuation">{</span>
    
    <span class="token keyword">private</span> <span class="token keyword">boolean</span> win<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">InstantLottery</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> win<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>win <span class="token operator">=</span> win<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isWin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> win<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Account</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">int</span> balance<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">putMoney</span><span class="token punctuation">(</span><span class="token keyword">int</span> money<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        balance <span class="token operator">+=</span> money<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">PeopleWithLottery</span> whybe <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PeopleWithLottery</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LinkedList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Account</span> 와이비통장 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Account</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">//즉석복권 구입</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//즉석복권 생성 로직 </span>
            <span class="token class-name">InstantLottery</span> instantLottery <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InstantLottery</span><span class="token punctuation">(</span>당첨여부<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//즉석복권긁기행위 객체 생성 및 커맨드 목록에 추가</span>
            <span class="token class-name">InstantScratch</span> 즉석복권긁기커맨드 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InstantScratch</span><span class="token punctuation">(</span>즉석복권<span class="token punctuation">,</span> 와이비통장<span class="token punctuation">)</span><span class="token punctuation">;</span>
            whybe<span class="token punctuation">.</span><span class="token function">addLotteryCommand</span><span class="token punctuation">(</span>즉석복권긁기커맨드<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
        whybe<span class="token punctuation">.</span><span class="token function">scratchAllLotery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>당첨을 확인하고 통장에 돈을 추가하는 것을 캡슐화하고, 긁는 행위를 호출하는 객체(People), 명령을 담장하는 객체(LotteryCommand) 그리고 명령 수행으로 인하여 영향을 받는 객체(MyAccount)가 모두 다르게 구성.</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NumberScratch</span> <span class="token keyword">implements</span> <span class="token class-name">LotteryCommand</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> winners<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">NumberLottery</span> numberLottery<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Account</span> account<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">NumberScratch</span><span class="token punctuation">(</span><span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> winners<span class="token punctuation">,</span> <span class="token class-name">NumberLottery</span> numberLottery<span class="token punctuation">,</span> <span class="token class-name">Account</span> account<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>winners <span class="token operator">=</span> winners<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>numberLottery <span class="token operator">=</span> numberLottery<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>account <span class="token operator">=</span> account<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">scratch</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// winners와 numberLottery를 비교하여 당첨금을 계산하고 </span>
        <span class="token comment">// account에 해당 금액을 입금하는 로직</span>
    <span class="token punctuation">}</span>   
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NumberLottery</span> <span class="token punctuation">{</span>
    
    <span class="token keyword">private</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> numbers<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">NumberLottery</span><span class="token punctuation">(</span><span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> numbers<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>numbers <span class="token operator">=</span> numbers<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">rank</span><span class="token punctuation">(</span><span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> winners<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 당첨 번호와 비교하여 자신의 등수를 계산하는 로직</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">PeopleWithLottery</span> whybe <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PeopleWithLottery</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LinkedList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Account</span> 영이통장 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Account</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">//즉석복권 구입</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//번호식 복권 생성 로직 </span>
            <span class="token class-name">NumberLottery</span> 번호식복권 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NumberLottery</span><span class="token punctuation">(</span>선택한 번호<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//번호식복권긁기행위 객체 생성 및 커맨드 목록에 추가</span>
            <span class="token class-name">NumberScratch</span> 번호식복권긁기커맨드 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NumberScratch</span><span class="token punctuation">(</span>이번주 당첨번호<span class="token punctuation">,</span> 번호식복권<span class="token punctuation">,</span> 영이통장<span class="token punctuation">)</span><span class="token punctuation">;</span>
            whybe<span class="token punctuation">.</span><span class="token function">addLotteryCommand</span><span class="token punctuation">(</span>번호식복권긁기커맨드<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        whybe<span class="token punctuation">.</span><span class="token function">scratchAllLottery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>행위를 캡슐화하여 복권을 긁는 행위를 호출하는 객체인 PeopleWithLottery와 명령 수행으로 인하여 영향을 받는 객체에 큰 변화를 거치지 않도록 만듬</p> <h3 id="전략패턴과-커맨드패턴의-차이"><a href="#전략패턴과-커맨드패턴의-차이" class="header-anchor">#</a> 전략패턴과 커맨드패턴의 차이</h3> <p>전략 패턴은 <code>어떻게</code>라는 측면에 집중. 커맨드 패턴은 <code>무엇</code>에 초점</p> <br> <h2 id="_1224-multipart"><a href="#_1224-multipart" class="header-anchor">#</a> 1224 - Multipart</h2> <h3 id="multipart란"><a href="#multipart란" class="header-anchor">#</a> Multipart란?</h3> <ul><li>웹 클라이언트가 요청을 보낼 때, http 프로토콜의 바디 부분에 데이터를 여러 부분으로 나눠서 보내는 것.
웹 클라이언트가 서버에게 파이을 업로드 할 때, http 프로토콜의 바디 부분에 파일정보를 담아서 전송을 하는데, 파일을 한번에 여러개 전송을 하면 body 부분에 파일이 여러개의 부분으롤 연결되어 전송된다. 이렇게 여러 부분으로 나뉘어서 전송되는 것을 Multipart data라고 한다.</li> <li>보통 파일을 전송할 때 사용한다.</li></ul> <h3 id="httpservletrequest는-파일-업로드를-지원하지-않는다"><a href="#httpservletrequest는-파일-업로드를-지원하지-않는다" class="header-anchor">#</a> HttpServletRequest는 파일 업로드를 지원하지 않는다.</h3> <ul><li>HttpServletRequest는 웹 클라이언트가 전달하는 Multipart 데이터를 쉽게 처리하는 메소드를 제공하지 않는다.
(HttpServletRequest는 http 프로토콜의 body 부분을 읽어들이는 input 스트림안을 지원, 사용자는 이런 input 스트림을 이용해서 Multipart부분을 잘 나누어서 사용해야한다. 보통은 직접 구현하지 않고 라이브러리를 사용)</li> <li>서블릿에서 파일 업로드를 처리하려면 별도의 라이브러리를 사용해야 한다. 대표적인 라이브러리가 아파치 재단의 commons-filedupload이다.</li></ul> <h3 id="spring-mvc에서의-파일-업로드"><a href="#spring-mvc에서의-파일-업로드" class="header-anchor">#</a> Spring MVC에서의 파일 업로드</h3> <p>Spring MVC에서 파일 업로드 하려면 몇가지 라이브러리와 설정을 추가</p> <ul><li>commons-fileupload, commons-io 라이브러리 추가</li> <li>MultipartResolver Bean 추가</li> <li>DispatcherServlet은 준비과정에서 &quot;multipart/form-data&quot;가 요청으로 올 경우 MultipartResolver를 사용한다.
(MultipartFile 매개변수를 사용하기 위해서는 MultipartResolver Bean이 등록되어있어야 한다.)</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">MultipartResolver</span> <span class="token function">multipartResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>multipart<span class="token punctuation">.</span>commons<span class="token punctuation">.</span></span>CommonsMultipartResolver</span> multipartResolver <span class="token operator">=</span> <span class="token keyword">new</span> 
    <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>multipart<span class="token punctuation">.</span>commons<span class="token punctuation">.</span></span>CommonsMultipartResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    multipartResolver<span class="token punctuation">.</span><span class="token function">setMaxUplaodSize</span><span class="token punctuation">(</span><span class="token number">10485760</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//1024 * 1024 * 10 (최대 10MB)</span>
    <span class="token keyword">return</span> multipartResolver<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ConditionalOnClass</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token class-name">Servlet</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">StandardServletMultipartResolver</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">MultipartConfigElement</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ConditionalOnProperty</span><span class="token punctuation">(</span>prefix <span class="token operator">=</span> <span class="token string">&quot;spring.servlet.multipart&quot;</span><span class="token punctuation">,</span> name <span class="token operator">=</span> <span class="token string">&quot;enabled&quot;</span><span class="token punctuation">,</span> matchIfMissing <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ConditionalOnWebApplication</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">Type</span><span class="token punctuation">.</span>SERVLET<span class="token punctuation">)</span>
<span class="token annotation punctuation">@EnableConfigurationProperties</span><span class="token punctuation">(</span><span class="token class-name">MultipartProperties</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MultipartAutoConfiguration</span> <span class="token punctuation">{</span>

	<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">MultipartProperties</span> multipartProperties<span class="token punctuation">;</span>

	<span class="token keyword">public</span> <span class="token class-name">MultipartAutoConfiguration</span><span class="token punctuation">(</span><span class="token class-name">MultipartProperties</span> multipartProperties<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>multipartProperties <span class="token operator">=</span> multipartProperties<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Bean</span>
	<span class="token annotation punctuation">@ConditionalOnMissingBean</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token class-name">MultipartConfigElement</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">CommonsMultipartResolver</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token keyword">public</span> <span class="token class-name">MultipartConfigElement</span> <span class="token function">multipartConfigElement</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>multipartProperties<span class="token punctuation">.</span><span class="token function">createMultipartConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token class-name">DispatcherServlet</span><span class="token punctuation">.</span>MULTIPART_RESOLVER_BEAN_NAME<span class="token punctuation">)</span>
	<span class="token annotation punctuation">@ConditionalOnMissingBean</span><span class="token punctuation">(</span><span class="token class-name">MultipartResolver</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
	<span class="token keyword">public</span> <span class="token class-name">StandardServletMultipartResolver</span> <span class="token function">multipartResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">StandardServletMultipartResolver</span> multipartResolver <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StandardServletMultipartResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		multipartResolver<span class="token punctuation">.</span><span class="token function">setResolveLazily</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>multipartProperties<span class="token punctuation">.</span><span class="token function">isResolveLazily</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> multipartResolver<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>MultipartResolver는 SpringMVC에서 기본적으로 등록해주지 않지만, SpringBoot에서는 위와 같이 MultipartAutoConfiguration클래스에서 MultipartResolver Bean이 등록되어있지 않는 경우 자동으로 Bean을 등록해준다. 따라서 SpringBoot에서는 별도의 설정없이 MultipartFile 매개변수를 사용할 수 있다.</p> <br> <h2 id="_1225-authenticationprincipal"><a href="#_1225-authenticationprincipal" class="header-anchor">#</a> 1225 - @AuthenticationPrincipal</h2> <p>스프링 시큐리티는 SecurityContext에 인증된 Authentication 객체를 넣어두고 현재 스레드 내에서 공유되도록 관리하고 있다.
보통은 인증 이후 @AuthenticationPrincipal 어노테이션을 통해 UserDetails 인터페이스를 구현한 유저 객체를 주입할 때 사용하는 편이다.</p> <p>관련 클래스와 인터페이스</p> <ul><li>SecurityContext : 인터페이스. Security Context 인터페이스. Authentication에 대한 접근 getter를 정의해 놓았다.</li> <li>SecurityContextImpl : 클래스. SecurityContext 인터페이스를 구현한 객체 Authentication 객체에 대한 getter/setter를 정의해 놓은 객체. 해당 구현체를 통해 내부적으로 현재 스레드의 Security Context를 생성하여 인증 후 Authentication 객체를 넣어놓는 역할을 한다.</li> <li>Authentication : 인증 정보에 대한 부분을 정의해놓은 인터페이스. Principal과 같은 Credentials, Authorities 에 대한 정의가 되어있다. 여러 구현체가 있다. (ex. UsernamePasswordAuthenticationToken)
<ul><li>Principal의 의미는 &quot;인증되는 주체의 ID&quot;</li> <li>Credentials은 &quot;주체가 정확한지 증명하는 것&quot;</li> <li>Authorities는 &quot;권한&quot;</li></ul></li> <li>UserDetails : 사용자 정보를 가지는 인터페이스. 이를 구현하여 실제 로그인에 사용할 클래스를 만들면 되고, 스프링 시큐리티 내부적으로 직접 사용하지는 않고 Authentication으로 캡슐화하여 저장된다. 따라서 UserDetails구현체의 정보는 Spring Security Context에 저장된 Authentication 객체가 가져간다.</li> <li>HandlerMethodArgumentResolver : 인터페이스. 특정 적략에 따라 한 request에서 넘어온 인자들을 메소드 파라미터로 해석할 수 있도록 도와줌</li> <li>AuthenticationPrincipalArgumentResolver : 스프링 시큐리티에서 HandlerMethodArgumentResolver를 구현한 구현체로 @AuthenticationPrincipal 어노테이션이 실제로 사용되는 부분.</li></ul> <h3 id="동작-원리"><a href="#동작-원리" class="header-anchor">#</a> 동작 원리</h3> <p>현재 스레드가 세션을 물고 있다면 이미 SecurityContextHolder의 getContext() 메소드를 통해 SecurityContext 객체를 얻고 그 안의 getAuthentication() 메소드를 통해 Authentication (인증객체)를 얻을 수 있다.</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/logout&quot;</span><span class="token punctuation">,</span> 
             consumes <span class="token operator">=</span> <span class="token class-name">MediaTypes</span><span class="token punctuation">.</span>HAL_JSON_VALUE<span class="token punctuation">,</span> 
             produces <span class="token operator">=</span> <span class="token class-name">MediaTypes</span><span class="token punctuation">.</span>HAL_JSON_VALUE<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">logout</span><span class="token punctuation">(</span><span class="token annotation punctuation">@AuthenticationPrincipal</span> <span class="token class-name">SecurityUser</span> securityUser<span class="token punctuation">,</span> 
                     <span class="token annotation punctuation">@RequestHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Authorization&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> authorization<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token comment">// 컨트롤러 로직</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Spring Security를 사용하는 경우, AuthenticationPrincipalArgumentResolver 클래스를 활용하여 resolveArgument 메소드를 구현하고 SecurityContext에 저장된 인증객체를 기반으로 Authentication 객체를 꺼내오게 된다.</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">AuthenticationPrincipalArgumentResolver</span> <span class="token keyword">implements</span> <span class="token class-name">HandlerMethodArgumentResolver</span> <span class="token punctuation">{</span>

	<span class="token keyword">private</span> <span class="token class-name">ExpressionParser</span> parser <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SpelExpressionParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">private</span> <span class="token class-name">BeanResolver</span> beanResolver<span class="token punctuation">;</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">supportsParameter</span><span class="token punctuation">(</span><span class="token class-name">MethodParameter</span> parameter<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token function">findMethodAnnotation</span><span class="token punctuation">(</span><span class="token class-name">AuthenticationPrincipal</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> parameter<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">resolveArgument</span><span class="token punctuation">(</span><span class="token class-name">MethodParameter</span> parameter<span class="token punctuation">,</span> <span class="token class-name">ModelAndViewContainer</span> mavContainer<span class="token punctuation">,</span>
			<span class="token class-name">NativeWebRequest</span> webRequest<span class="token punctuation">,</span> <span class="token class-name">WebDataBinderFactory</span> binderFactory<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            
        <span class="token comment">// Security Context에서 꺼내욘 객체를 기반으로 한다.</span>
		<span class="token class-name">Authentication</span> authentication <span class="token operator">=</span> <span class="token class-name">SecurityContextHolder</span><span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAuthentication</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>authentication <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

        <span class="token comment">// 인증객체에서 Principal을 꺼낸다.</span>
		<span class="token class-name">Object</span> principal <span class="token operator">=</span> authentication<span class="token punctuation">.</span><span class="token function">getPrincipal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 해당 어노테이션이 붙은 파라미터가 존재하는지 찾는다.</span>
		<span class="token class-name">AuthenticationPrincipal</span> annotation <span class="token operator">=</span> <span class="token function">findMethodAnnotation</span><span class="token punctuation">(</span><span class="token class-name">AuthenticationPrincipal</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> parameter<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">String</span> expressionToParse <span class="token operator">=</span> annotation<span class="token punctuation">.</span><span class="token function">expression</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">hasLength</span><span class="token punctuation">(</span>expressionToParse<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token class-name">StandardEvaluationContext</span> context <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StandardEvaluationContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			context<span class="token punctuation">.</span><span class="token function">setRootObject</span><span class="token punctuation">(</span>principal<span class="token punctuation">)</span><span class="token punctuation">;</span>
			context<span class="token punctuation">.</span><span class="token function">setVariable</span><span class="token punctuation">(</span><span class="token string">&quot;this&quot;</span><span class="token punctuation">,</span> principal<span class="token punctuation">)</span><span class="token punctuation">;</span>
			context<span class="token punctuation">.</span><span class="token function">setBeanResolver</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>beanResolver<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token class-name">Expression</span> expression <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>parser<span class="token punctuation">.</span><span class="token function">parseExpression</span><span class="token punctuation">(</span>expressionToParse<span class="token punctuation">)</span><span class="token punctuation">;</span>
			principal <span class="token operator">=</span> expression<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>principal <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>parameter<span class="token punctuation">.</span><span class="token function">getParameterType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>principal<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>annotation<span class="token punctuation">.</span><span class="token function">errorOnInvalidType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ClassCastException</span><span class="token punctuation">(</span>principal <span class="token operator">+</span> <span class="token string">&quot; is not assignable to &quot;</span> <span class="token operator">+</span> parameter<span class="token punctuation">.</span><span class="token function">getParameterType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

        <span class="token comment">// principal 리턴</span>
		<span class="token keyword">return</span> principal<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setBeanResolver</span><span class="token punctuation">(</span><span class="token class-name">BeanResolver</span> beanResolver<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>beanResolver <span class="token operator">=</span> beanResolver<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">private</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span> <span class="token keyword">extends</span> <span class="token class-name">Annotation</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">T</span> <span class="token function">findMethodAnnotation</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> annotationClass<span class="token punctuation">,</span> <span class="token class-name">MethodParameter</span> parameter<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">T</span> annotation <span class="token operator">=</span> parameter<span class="token punctuation">.</span><span class="token function">getParameterAnnotation</span><span class="token punctuation">(</span>annotationClass<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>annotation <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> annotation<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token class-name">Annotation</span><span class="token punctuation">[</span><span class="token punctuation">]</span> annotationsToSearch <span class="token operator">=</span> parameter<span class="token punctuation">.</span><span class="token function">getParameterAnnotations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Annotation</span> toSearch <span class="token operator">:</span> annotationsToSearch<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			annotation <span class="token operator">=</span> <span class="token class-name">AnnotationUtils</span><span class="token punctuation">.</span><span class="token function">findAnnotation</span><span class="token punctuation">(</span>toSearch<span class="token punctuation">.</span><span class="token function">annotationType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> annotationClass<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>annotation <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">return</span> annotation<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>컨트롤러의 파라미터마다 해당 resolveArgument 메소드가 실행된다.</p></div></div></div> <footer class="footer" data-v-3d9deeb8><div class="footer-left-wrap" data-v-3d9deeb8><ul class="contact" data-v-3d9deeb8></ul></div> <div class="footer-right-wrap" data-v-3d9deeb8><ul class="copyright" data-v-3d9deeb8></ul></div></footer></div><div class="global-ui"></div></div>
    <script src="/TIL/assets/js/app.face42bf.js" defer></script><script src="/TIL/assets/js/6.5d7ec74f.js" defer></script><script src="/TIL/assets/js/11.eca71194.js" defer></script><script src="/TIL/assets/js/51.c3bdfcaa.js" defer></script>
  </body>
</html>
