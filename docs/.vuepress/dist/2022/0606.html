<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>0606 ~ 0619 | TIL</title>
    <meta name="generator" content="VuePress 1.8.0">
    
    <meta name="description" content="Today I Learned">
    
    <link rel="preload" href="/TIL/assets/css/0.styles.7d1de6ab.css" as="style"><link rel="preload" href="/TIL/assets/js/app.30a336f9.js" as="script"><link rel="preload" href="/TIL/assets/js/2.4f3b10d1.js" as="script"><link rel="preload" href="/TIL/assets/js/64.5042f020.js" as="script"><link rel="prefetch" href="/TIL/assets/js/10.a9eff2c6.js"><link rel="prefetch" href="/TIL/assets/js/11.c431cdaf.js"><link rel="prefetch" href="/TIL/assets/js/12.6be9f680.js"><link rel="prefetch" href="/TIL/assets/js/13.e248d69e.js"><link rel="prefetch" href="/TIL/assets/js/14.45cef0dc.js"><link rel="prefetch" href="/TIL/assets/js/15.79ddc0c8.js"><link rel="prefetch" href="/TIL/assets/js/16.3127f806.js"><link rel="prefetch" href="/TIL/assets/js/17.8ba02f59.js"><link rel="prefetch" href="/TIL/assets/js/18.99221f05.js"><link rel="prefetch" href="/TIL/assets/js/19.36c93a98.js"><link rel="prefetch" href="/TIL/assets/js/20.70bfe030.js"><link rel="prefetch" href="/TIL/assets/js/21.690a4364.js"><link rel="prefetch" href="/TIL/assets/js/22.875d341c.js"><link rel="prefetch" href="/TIL/assets/js/23.513e2a69.js"><link rel="prefetch" href="/TIL/assets/js/24.629fbc52.js"><link rel="prefetch" href="/TIL/assets/js/25.8045ce68.js"><link rel="prefetch" href="/TIL/assets/js/26.c2141044.js"><link rel="prefetch" href="/TIL/assets/js/27.33d41080.js"><link rel="prefetch" href="/TIL/assets/js/28.9f31a1d2.js"><link rel="prefetch" href="/TIL/assets/js/29.1e360771.js"><link rel="prefetch" href="/TIL/assets/js/3.9c66dc28.js"><link rel="prefetch" href="/TIL/assets/js/30.89b5a2b9.js"><link rel="prefetch" href="/TIL/assets/js/31.1070f747.js"><link rel="prefetch" href="/TIL/assets/js/32.0facc3bd.js"><link rel="prefetch" href="/TIL/assets/js/33.6f7c0cac.js"><link rel="prefetch" href="/TIL/assets/js/34.30c7a1f6.js"><link rel="prefetch" href="/TIL/assets/js/35.51535786.js"><link rel="prefetch" href="/TIL/assets/js/36.41310eb1.js"><link rel="prefetch" href="/TIL/assets/js/37.2e9db11f.js"><link rel="prefetch" href="/TIL/assets/js/38.5792cf1b.js"><link rel="prefetch" href="/TIL/assets/js/39.3a591008.js"><link rel="prefetch" href="/TIL/assets/js/4.865692a8.js"><link rel="prefetch" href="/TIL/assets/js/40.321d9181.js"><link rel="prefetch" href="/TIL/assets/js/41.50eb8cb5.js"><link rel="prefetch" href="/TIL/assets/js/42.256ebdde.js"><link rel="prefetch" href="/TIL/assets/js/43.205790b4.js"><link rel="prefetch" href="/TIL/assets/js/44.e9c8df43.js"><link rel="prefetch" href="/TIL/assets/js/45.3b3e4884.js"><link rel="prefetch" href="/TIL/assets/js/46.5c7d6332.js"><link rel="prefetch" href="/TIL/assets/js/47.d11d3aeb.js"><link rel="prefetch" href="/TIL/assets/js/48.81b2f8a1.js"><link rel="prefetch" href="/TIL/assets/js/49.07056705.js"><link rel="prefetch" href="/TIL/assets/js/5.81254301.js"><link rel="prefetch" href="/TIL/assets/js/50.abbfe32f.js"><link rel="prefetch" href="/TIL/assets/js/51.1c8ac719.js"><link rel="prefetch" href="/TIL/assets/js/52.1ca9ee11.js"><link rel="prefetch" href="/TIL/assets/js/53.383b04ab.js"><link rel="prefetch" href="/TIL/assets/js/54.7802ecfe.js"><link rel="prefetch" href="/TIL/assets/js/55.7523e985.js"><link rel="prefetch" href="/TIL/assets/js/56.8bec5797.js"><link rel="prefetch" href="/TIL/assets/js/57.63123b55.js"><link rel="prefetch" href="/TIL/assets/js/58.b3944ec3.js"><link rel="prefetch" href="/TIL/assets/js/59.2608905a.js"><link rel="prefetch" href="/TIL/assets/js/6.6e8c67be.js"><link rel="prefetch" href="/TIL/assets/js/60.be8d941f.js"><link rel="prefetch" href="/TIL/assets/js/61.a80c3251.js"><link rel="prefetch" href="/TIL/assets/js/62.555726a9.js"><link rel="prefetch" href="/TIL/assets/js/63.3776a4df.js"><link rel="prefetch" href="/TIL/assets/js/65.c911753f.js"><link rel="prefetch" href="/TIL/assets/js/66.be38f613.js"><link rel="prefetch" href="/TIL/assets/js/67.cf9a7e47.js"><link rel="prefetch" href="/TIL/assets/js/68.d1632083.js"><link rel="prefetch" href="/TIL/assets/js/69.f724656e.js"><link rel="prefetch" href="/TIL/assets/js/7.d16b084a.js"><link rel="prefetch" href="/TIL/assets/js/70.ff105059.js"><link rel="prefetch" href="/TIL/assets/js/71.a3f94747.js"><link rel="prefetch" href="/TIL/assets/js/72.30bd027e.js"><link rel="prefetch" href="/TIL/assets/js/73.317d4422.js"><link rel="prefetch" href="/TIL/assets/js/74.0543a273.js"><link rel="prefetch" href="/TIL/assets/js/75.bc28dd34.js"><link rel="prefetch" href="/TIL/assets/js/76.d92a82e4.js"><link rel="prefetch" href="/TIL/assets/js/77.e3e3d1ee.js"><link rel="prefetch" href="/TIL/assets/js/78.ec537641.js"><link rel="prefetch" href="/TIL/assets/js/79.cc8377fd.js"><link rel="prefetch" href="/TIL/assets/js/8.cf88ad19.js"><link rel="prefetch" href="/TIL/assets/js/80.476f666d.js"><link rel="prefetch" href="/TIL/assets/js/9.2a229c54.js">
    <link rel="stylesheet" href="/TIL/assets/css/0.styles.7d1de6ab.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/TIL/" class="home-link router-link-active"><!----> <span class="site-name">TIL</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://github.com/jaesungahn91" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://velog.io/@ahnjs" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Blog
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://github.com/jaesungahn91" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://velog.io/@ahnjs" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Blog
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>2022</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/TIL/2022/0102.html" class="sidebar-link">0102 - 0109</a></li><li><a href="/TIL/2022/0110.html" class="sidebar-link">0110 - 0116</a></li><li><a href="/TIL/2022/0117.html" class="sidebar-link">0117 - 0123</a></li><li><a href="/TIL/2022/0124.html" class="sidebar-link">0124 - 0206</a></li><li><a href="/TIL/2022/0211.html" class="sidebar-link">0211 - 0220</a></li><li><a href="/TIL/2022/0221.html" class="sidebar-link">0221 - 0227</a></li><li><a href="/TIL/2022/0228.html" class="sidebar-link">0228 - 0313</a></li><li><a href="/TIL/2022/0314.html" class="sidebar-link">0314 - 0320</a></li><li><a href="/TIL/2022/0321.html" class="sidebar-link">0321 - 0328</a></li><li><a href="/TIL/2022/0328.html" class="sidebar-link">0329 ~ 0403</a></li><li><a href="/TIL/2022/0404.html" class="sidebar-link">0404 ~ 0410</a></li><li><a href="/TIL/2022/0411.html" class="sidebar-link">0411 ~ 0417</a></li><li><a href="/TIL/2022/0418.html" class="sidebar-link">0418 ~ 0424</a></li><li><a href="/TIL/2022/0425.html" class="sidebar-link">0425 ~ 0501</a></li><li><a href="/TIL/2022/0502.html" class="sidebar-link">0502 ~ 0515</a></li><li><a href="/TIL/2022/0516.html" class="sidebar-link">0516 ~ 0529</a></li><li><a href="/TIL/2022/0523.html" class="sidebar-link">0523 ~ 0605</a></li><li><a href="/TIL/2022/0606.html" aria-current="page" class="active sidebar-link">0606 ~ 0619</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/TIL/2022/0606.html#_0610-테스트-더블-test-double" class="sidebar-link">0610 - 테스트 더블 (Test Double)</a></li><li class="sidebar-sub-header"><a href="/TIL/2022/0606.html#_0613-orphanremoval" class="sidebar-link">0613 - orphanRemoval</a></li><li class="sidebar-sub-header"><a href="/TIL/2022/0606.html#_0615-cqrs" class="sidebar-link">0615 - CQRS</a></li><li class="sidebar-sub-header"><a href="/TIL/2022/0606.html#_0616-msa와-soa의-차이" class="sidebar-link">0616 - MSA와 SOA의 차이</a></li><li class="sidebar-sub-header"><a href="/TIL/2022/0606.html#_0618-자바-테스트-격리" class="sidebar-link">0618 - 자바 테스트 격리</a></li></ul></li><li><a href="/TIL/2022/0627.html" class="sidebar-link">0627 ~ 0703</a></li><li><a href="/TIL/2022/0711.html" class="sidebar-link">0711 ~ 0717</a></li><li><a href="/TIL/2022/0718.html" class="sidebar-link">0718 ~ 0724</a></li><li><a href="/TIL/2022/0725.html" class="sidebar-link">0725 ~ 0807</a></li><li><a href="/TIL/2022/0808.html" class="sidebar-link">0808 ~ 0814</a></li><li><a href="/TIL/2022/0815.html" class="sidebar-link">0815 ~ 0824</a></li><li><a href="/TIL/2022/0822.html" class="sidebar-link">0822 ~ 0911</a></li><li><a href="/TIL/2022/0912.html" class="sidebar-link">0912 ~ 0918</a></li><li><a href="/TIL/2022/0919.html" class="sidebar-link">0919 ~ 0925</a></li><li><a href="/TIL/2022/0926.html" class="sidebar-link">0926 ~ 1002</a></li><li><a href="/TIL/2022/1003.html" class="sidebar-link">1003 ~ 1009</a></li><li><a href="/TIL/2022/1010.html" class="sidebar-link">1010 ~ 1016</a></li><li><a href="/TIL/2022/1017.html" class="sidebar-link">1017 ~ 1030</a></li><li><a href="/TIL/2022/1031.html" class="sidebar-link">1031 ~ 1113</a></li><li><a href="/TIL/2022/1114.html" class="sidebar-link">1114 ~ 1120</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>2021</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="_0606-0619"><a href="#_0606-0619" class="header-anchor">#</a> 0606 ~ 0619</h1> <h2 id="_0610-테스트-더블-test-double"><a href="#_0610-테스트-더블-test-double" class="header-anchor">#</a> 0610 - 테스트 더블 (Test Double)</h2> <h3 id="테스트-더블-test-double-이란"><a href="#테스트-더블-test-double-이란" class="header-anchor">#</a> 테스트 더블(Test Double)이란?</h3> <p>xUnit Test Patterns의 저자인 제라드 메스자로스가 만든 용어로 테스트를 진행하기 어려운 경우 이를 대신해 테스트를 진행할 수 있도록 만들어주는 객체를 말한다.</p> <p>예를 들어 우리가 데이터베이스로부터 조회한 값을 연산하는 로직을 구현했다고 하자. 해당 로직을 테스트하기 위해선 항상 데이터베이스의 영향을 받을 것이고, 이는 데이터베이스의 상태에 따라 다른 결과를 유발할 수도 있다.</p> <p>이렇게 테스트하려는 객체와 연관된 객체를 사용하기가 어렵고 모호할 때 대신 해줄 수 있는 객체를 테스트 더블이라 한다.</p> <h3 id="테스트-더블의-종류"><a href="#테스트-더블의-종류" class="header-anchor">#</a> 테스트 더블의 종류</h3> <p>테스트 더블은 크게 Dummy, Fake, Stub, Spy, Mock으로 나뉜다.</p> <h4 id="_1-dummy"><a href="#_1-dummy" class="header-anchor">#</a> 1. Dummy</h4> <ul><li>가장 기본적인 테스트 더블이다.</li> <li>인스턴스화 된 객체가 필요하지만 기능은 필요하지 않은 경우에 사용한다.</li> <li>Dummy 객체의 메서드가 호출되었을 때 정상 동작은 보장하지 않는다.</li> <li>객체는 전달되지만 사용되지 않는 객체이다.</li></ul> <p>정리하면 인스턴스화된 객체가 필요해서 구현한 가짜 객체일 뿐이고, 생성된 Dummy 객체는 정상적인 동작을 보장하지 않는다.</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">PringWarning</span> <span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PrintWarningDummy</span> <span class="token keyword">implements</span> <span class="token class-name">PrintWarning</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 아무런 동작을 하지 않는다.</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>실제 객체는 PrintWarning 인터페이스의 구현체를 필요하지만, 특정 테스트에서는 해당 구현체의 동작이 전혀 필요하지 않을 수 있다. 실제 객체가 로그용 경고만 출력한다면 테스트 환경에서는 전혀 필요 없기 때문이다.<br>
이런 경우에는 print()가 아무런 동작을 하지 않아도 테스트에는 영향을 미치지 않는다.<br>
이처럼 동작하지 않아도 테스트에는 영향을 미치지 않는 객체를 Dummy 객체라고 한다.</p> <h4 id="_2-fake"><a href="#_2-fake" class="header-anchor">#</a> 2. Fake</h4> <ul><li>복잡한 로직이나 객체 내부에서 필요로 하는 다른 외부 객체들의 동작을 단순화하여 구현한 객체이다.</li> <li>동작의 구현을 가지고 있지만 실제 프로덕션에는 적합하지 않은 객체이다.</li></ul> <p>정리하면 동작은 하지만 실제 사용되는 객체처럼 정교하게 동작하지는 않는 객체를 말한다.</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Entity</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Id</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
    
    <span class="token keyword">protected</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    
    <span class="token keyword">public</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token class-name">Long</span> id<span class="token punctuation">,</span> <span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">public</span> <span class="token class-name">Long</span> <span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>id<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserRepository</span> <span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">User</span> <span class="token function">findById</span><span class="token punctuation">(</span><span class="token keyword">long</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FakeUserRepository</span> <span class="token keyword">implements</span> <span class="token class-name">UserRepository</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> users <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">findById</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            user<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">findById</span><span class="token punctuation">(</span><span class="token keyword">long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">User</span> user <span class="token operator">:</span> users<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> user<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>테스트해야 하는 객체가 데이터베이스와 연관되어 있다고 가정한다.</p> <p>그럴 경우 실제 데이터베이스를 연결해서 테스트해야 하지만, 실제 데이터베이스 대신 가짜 데이터베이스 역할을 하는 FakeUserRepository를 만들어 테스트객체에 주입하는 방법도 있다. 이렇게 하면 테스트 객체는 데이터베이스에 의존하지 않으면서도 동일하게 동작을하는 가짜 데이터베이스를 가지게 된다.</p> <h4 id="_3-stub"><a href="#_3-stub" class="header-anchor">#</a> 3. Stub</h4> <ul><li>Dummy 객체가 실제로 동작하는 것 처럼 보이게 만들어 놓은 객체이다.</li> <li>인터페이스 또는 기본 클래스가 최소한으로 구현된 상태이다.</li> <li>테스트에서 호출된 요청에 대해 미리 준비해둔 결과를 제공한다.</li></ul> <p>정리하면 테스트를 위해 프로그래밍된 내용에 대해서만 준비된 결과를 제공하는 객체이다.</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StubUserRepository</span> <span class="token keyword">implements</span> <span class="token class-name">UserRepository</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">findById</span><span class="token punctuation">(</span><span class="token keyword">long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> <span class="token string">&quot;Test User&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>위의 코드처럼 StubUserRepository는 findByID() 메서드를 사용하면 언제나 동일한 id값에 TestUser라는 이름을 가진 User 인스턴스를 반환받는다.<br>
테스트 환경에서 User 인스턴스의 name을 Test User만 받기를 원하는 경우 이처럼 동작하는 객체를 만들어 사용할 수 있다.<br>
물론 이러한 방식의 단점은 테스트가 수정될 경우 Stub 객체도 함께 수정해야 하는 단점이 있다.<br>
우리가 테스트에서 자주 사용하는 Mockito 프레임워크도 Stub와 같은 역할을 해준다.<br>
이처럼 테스트를 위해 의도한 결과만 반환되도록 하기 위한 객체가 Stub이다.</p> <h4 id="_4-spy"><a href="#_4-spy" class="header-anchor">#</a> 4. Spy</h4> <ul><li>Stub의 역할을 가지면서 호출된 내용에 대해 약간의 정보를 기록한다.</li> <li>테스트 더블로 구현된 객체에 자기 자신이 호출 되었을 때 확인이 필요한 부분을 기록하도록 구현한다.</li> <li>실체 객체처럼 동작시킬 수도 있고, 필요한 부분에 대해서는 Stub로 만들어서 동작을 지정할 수도 있다.</li></ul> <p>정리하면 실제 객체로도 사용할 수 있고 Stub 객체로도 활용할 수 있으며 필요한경우 특정 메서드가 제대로 호출되었는지 여부를 확인할 수 있다.</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MailingService</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> sendMailCount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Mail</span><span class="token punctuation">&gt;</span></span> mails <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sendMail</span><span class="token punctuation">(</span><span class="token class-name">Mail</span> mail<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        sendMailCount<span class="token operator">++</span><span class="token punctuation">;</span>
        mails<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>mail<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">getSendMailCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> sendMailCount<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>MailingService는 sendMail을 호출할 때마다 보낸 메일을 저장하고 몇 번 보냈는지를 체크한다. 그리고 나중에 메일을 보낸 횟수를 물어볼 때 sendMailCount를 반환한다.<br>
이처럼 자기 자신이 호출된 상황을 확인할 수 있는 객체가 Spy이다.<br>
이 또한 Mockito 프레임워크의 verify() 메서드가 같은 역할을 한다.</p> <h4 id="_5-mock"><a href="#_5-mock" class="header-anchor">#</a> 5. Mock</h4> <ul><li>호출에 대한 기대를 명세하고 내용에 따라 동작하도록 프로그래밍 된 객체.</li> <li>Mockito 프레임워크가 대표적인 Mock 프레임워크.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@ExtendWith</span><span class="token punctuation">(</span><span class="token class-name">MockitoExtension</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserServiceTest</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Mock</span>
    <span class="token keyword">private</span> <span class="token class-name">UserRepository</span> userRepository<span class="token punctuation">;</span>
    
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">when</span><span class="token punctuation">(</span>userRepository<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span><span class="token function">anyLong</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;Test User&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token class-name">User</span> actual <span class="token operator">=</span> userService<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">assertThat</span><span class="token punctuation">(</span>actual<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">assertThat</span><span class="token punctuation">(</span>actual<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token string">&quot;Test User&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_0613-orphanremoval"><a href="#_0613-orphanremoval" class="header-anchor">#</a> 0613 - orphanRemoval</h2> <p>부모 엔티티와 연관관계가 끊어진 자식 엔티티를 자동으로 삭제해주는 기능이다.</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Entity</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Parent</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Id</span>
    <span class="token annotation punctuation">@GeneratedValue</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> username<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@OneToMany</span><span class="token punctuation">(</span>mappedBy <span class="token operator">=</span> <span class="token string">&quot;parent&quot;</span><span class="token punctuation">,</span> cascade <span class="token operator">=</span> <span class="token class-name">CascadeType</span><span class="token punctuation">.</span>ALL<span class="token punctuation">,</span> orphanRemoval <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Child</span><span class="token punctuation">&gt;</span></span> childList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>orphanRemoval가 true 시</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Parent</span> parent1 <span class="token operator">=</span> em<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token class-name">Parent</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> parent<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
parent1<span class="token punctuation">.</span><span class="token function">getChildList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// delete 쿼리나간다.</span>
</code></pre></div><p>자동으로 delete 쿼리가 나간다.</p> <ul><li>이 속성은 참조하는 곳이 하나일 때만 사용해야 한다.</li> <li>특정 엔티티가 개인 소유할 때만 사용해야 한다.</li> <li>@OneToOne과 @OneToMany에서만 사용이 가능하다.</li></ul> <p>CascadeType.ALL + orphanRemovel=true<br>
이 두개를 같이 사용하게 되면 부모 엔티티가 자식의 생명주기를 모두 관리할 수 있게 된다.</p> <br> <h2 id="_0615-cqrs"><a href="#_0615-cqrs" class="header-anchor">#</a> 0615 - CQRS</h2> <h3 id="cqrs-아키텍처란"><a href="#cqrs-아키텍처란" class="header-anchor">#</a> CQRS 아키텍처란?</h3> <p><img src="https://velog.velcdn.com/images/sangmin7648/post/306d4956-1d8b-474f-b3b9-431b0cb993ed/image.png" alt="image"></p> <blockquote><p>명령(시스템 데이터 변경) 역할을 수행하는 구성 요소와 쿼리(시스템 데이터 조회) 역할을 구새항하는 구성 요소를 나누는 아키텍처</p></blockquote> <p>시스템 데이터를 변경하는 코드와 시스템 데이터를 조회하는 코드를 따로 만드는 것, 구현방식이나 시스템 규모에 따라서 DB를 나누기도하고 프로세스를 나누기도 함</p> <ul><li>Command : 명령
<ul><li>시스템 데이터 변경</li> <li>ex) 주문 생성, 수정, 취소</li></ul></li> <li>Query : 조회
<ul><li>시스템 데이터 조회</li> <li>ex) 주문 조회</li></ul></li> <li>Responsibility : 책임
<ul><li>구성 요소의 역할</li> <li>구성 요소 ex) 클래스, 함수, 모듈, 패키지, 웹서버, DB 등</li></ul></li> <li>Segregation : 역할에 따라 구성 요소 나누기</li></ul> <h3 id="단일-모델의-단점"><a href="#단일-모델의-단점" class="header-anchor">#</a> 단일 모델의 단점</h3> <blockquote><p>명령과 쿼리를 구분해 피할 수 있는 문제들</p></blockquote> <p><img src="https://velog.velcdn.com/images%2Fsangmin7648%2Fpost%2F955c1e24-1f0a-49db-a913-eb66cb07e0f0%2Fimage.png" alt="image"></p> <ul><li>기능 추가에 따라 코드의 책임이 모호해지고, 기능마다 다른 테이블에 의존하게 된다</li> <li>명령은 한 영역의 데이터를 다루는데 반해 쿼리는 여러 영역의 데이터를 사용한다.</li> <li>명령과 쿼리는 코드 변경 빈도와 사용자가 다르다. 서로 다른 이유로 모델의 코드가 바뀐다는 것은 책임의 분리가 적절하지 않다는 것이다.</li> <li>기능마다 요구 성능이 다르다. 단일 모델은 기능에 맞는 다양한 성능 향상 기법 적용이 어렵다.
<ul><li>ex) 명령 : 사용자 주문 기능, 쿼리 : 백오피스 주문 목록 조회</li></ul></li></ul> <h3 id="cqrs의-구현"><a href="#cqrs의-구현" class="header-anchor">#</a> CQRS의 구현</h3> <h4 id="같은-프로세스-같은-dbms"><a href="#같은-프로세스-같은-dbms" class="header-anchor">#</a> 같은 프로세스, 같은 DBMS</h4> <p><img src="https://velog.velcdn.com/images%2Fsangmin7648%2Fpost%2F10c1fe6b-f5c6-4cff-b5ea-6ac29da9efc1%2Fimage.png" alt="image"></p> <ul><li>코드 수준에서만 명령과 쿼리가 분리된다</li> <li>데이터의 동일성이 보장된다</li></ul> <h4 id="같은-프로세스-같은-dbms-다른-테이블"><a href="#같은-프로세스-같은-dbms-다른-테이블" class="header-anchor">#</a> 같은 프로세스, 같은 DBMS, 다른 테이블</h4> <p><img src="https://velog.velcdn.com/images%2Fsangmin7648%2Fpost%2Fb3dd095d-34b8-4050-8dbb-9fd5cabc5bd6%2Fimage.png" alt="Image"></p> <ul><li>쿼리 전용 테이블을 사용한다</li> <li>코드 수준, 데이터 수준에서 명령과 쿼리가 분리된다</li> <li>명령이 데이터를 변경할때, 쿼리 전용 테이블도 수정해야한다</li></ul> <h4 id="같은-프로세스-다른-dbms"><a href="#같은-프로세스-다른-dbms" class="header-anchor">#</a> 같은 프로세스, 다른 DBMS</h4> <p><img src="https://velog.velcdn.com/images%2Fsangmin7648%2Fpost%2F4374065b-f002-4f23-8b0f-967fcade226e%2Fimage.png" alt="image"></p> <ul><li>Redis를 캐시로 하고 쿼리 DB로 사용하는 경우를 생각해볼 수 있다</li></ul> <h4 id="다른-프로세스-다른-dbms"><a href="#다른-프로세스-다른-dbms" class="header-anchor">#</a> 다른 프로세스, 다른 DBMS</h4> <p>![image]</p> <ul><li>MSA를 생각해볼 수 있다</li></ul> <h3 id="_3가지-변경-전파-전략"><a href="#_3가지-변경-전파-전략" class="header-anchor">#</a> 3가지 변경 전파 전략</h3> <blockquote><p>CQRS 아키텍처에서 여러 DBMS를 사용하게 된다면 변경 전파 전략도 수립해야 한다</p></blockquote> <h4 id="명령이-쿼리-dbms를-수정"><a href="#명령이-쿼리-dbms를-수정" class="header-anchor">#</a> 명령이 쿼리 DBMS를 수정</h4> <ul><li>구현이 단순</li> <li>쿼리 DB 장애시 데이터 유실 가능성이 있다</li> <li>명령 기능이 쿼리 DB까지 접근하기 때문에 명령 기능의 에러 가능성이 높다</li></ul> <h4 id="변경-내용-기록-후-전파기-사용"><a href="#변경-내용-기록-후-전파기-사용" class="header-anchor">#</a> 변경 내용 기록 후, 전파기 사용</h4> <ul><li>명령 DB에 변경 내용 테이블을 관리해야한다</li> <li>데이터 변경과 변경 내용을 하나의 트랜잭션으로 처리할 수 있어 데이터 유실 방지가 가능하다</li> <li>전파기를 구현해야한다</li></ul> <h4 id="db가-제공하는-cdc-사용"><a href="#db가-제공하는-cdc-사용" class="header-anchor">#</a> DB가 제공하는 CDC 사용</h4> <ul><li>CDC : 데이터베이스에 있는 데이터의 변경을 파악하고 추적하는 소프트웨어 프로세스</li> <li>명령 DB 바이너리 로그를 읽어 변경을 파악하고, 쿼리 DB에 전달할 수 있다</li> <li>명령 코드가 변경 내용을 관리할 필요가 없다</li></ul> <br> <h2 id="_0616-msa와-soa의-차이"><a href="#_0616-msa와-soa의-차이" class="header-anchor">#</a> 0616 - MSA와 SOA의 차이</h2> <h3 id="soa-msa란"><a href="#soa-msa란" class="header-anchor">#</a> SOA, MSA란?</h3> <blockquote><p>SOA는 서비스 지향 설계 방식(Service Oriented Architecture)<br>
SOA는 서비스 단위로 개발을 하고, 개발된 서비스들을 공유함으로써 재가용성을 늘리고 유연성을 확보하는 것을 목표</p></blockquote> <blockquote><p>MSA는 마이크로 서비스 설계 방식(Micro Service Architecture)<br>
MSA 또한 아주 작은 단위의 서비스로 소프트웨어를 구성함으로써 민첩하고 유연한 설계하는 것을 목표</p></blockquote> <h4 id="공유-지향점"><a href="#공유-지향점" class="header-anchor">#</a> 공유 지향점</h4> <p><img src="https://velog.velcdn.com/images/hwang95/post/a979a2bc-d5c3-4f70-8249-bfd6cc016b10/soamsa.PNG" alt="image"></p> <p>SOA는 비지니스 측면에서의 서비스 재사용성을 중요시하여 ESB(Enterprise Service Bus)라는 서비스 채널 이용 -&gt; 서비스 공유, 재사용</p> <p>MSA는 한 가지 작은 서비스에 집중하여 서비스 공유하지 않고 독립적 실행</p> <ul><li>SOA : 재사용을 통한 비용 절감</li> <li>MSA : 서비스 간의 결합도를 낮추어 변화에 능동적으로 대응</li></ul> <h4 id="기술-방식"><a href="#기술-방식" class="header-anchor">#</a> 기술 방식</h4> <ul><li>SOA는 공통의 서비스를 esb에 모아 사업 측면에서 공통 서비스 형식으로 서비스 제공</li> <li>MSA는 각 독립된 서비스가 노출된 REST API를 사용</li> <li>SOA는 서비스를 개발하고 최대한 재가용</li> <li>MSA는 서비스가 공유되기 보다 독립적으로 실행되는 것을 지향</li></ul> <br> <h2 id="_0618-자바-테스트-격리"><a href="#_0618-자바-테스트-격리" class="header-anchor">#</a> 0618 - 자바 테스트 격리</h2> <h3 id="테스트-격리란"><a href="#테스트-격리란" class="header-anchor">#</a> 테스트 격리란?</h3> <p>테스트는 순서에 상관없이 독립적으로 실행되며 결정적으로 수행되어야 한다. 테스트를 서로 격리하여 한 테스트를 실행하여도 다른 테스트에 영향을 주지 않도록 해야한다.</p> <h3 id="계층별-테스트"><a href="#계층별-테스트" class="header-anchor">#</a> 계층별 테스트</h3> <p>데이터들이 공유되기 때문에 불완전한 테스트를 작성하게 된다. 따라서 데이터베이스를 얼마나 의존하지 않고 테스트를 작성할지 또는 데이터 베이스 상태를 테스트 이전으로 돌릴지에 대해서 신경을 써야 한다.
<img src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&amp;fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FoxF8l%2FbtqUzwxi3Jt%2F7NE1JMAJPb7XMAyFJ2y6kk%2Fimg.png" alt="image"></p> <h4 id="domain-pojo-계층"><a href="#domain-pojo-계층" class="header-anchor">#</a> - Domain(POJO) 계층</h4> <ul><li>애플리케이션의 POJO(Model, Utils, etc...)는 JUnit으로 테스트</li> <li>객체는 new 연산자(또는 빌더)로 간단히 인스턴스화</li> <li>각각의 테스트가 실행되기 전에 @BeforeEach에서 인스턴스 초기화</li> <li>데이터베이스를 사용하지 않기 때문에 격리를 걱정할 필요 없음</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token class-name">Question</span> question<span class="token punctuation">;</span>

<span class="token annotation punctuation">@BeforeEach</span>
<span class="token keyword">void</span> <span class="token function">setUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    question <span class="token operator">=</span> <span class="token class-name">Question</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">userId</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">title</span><span class="token punctuation">(</span>TEST_QUETION_TITLE<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">content</span><span class="token punctuation">(</span>TEST_QUESTION_CONTENT<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@DisplayName</span><span class="token punctuation">(</span><span class="token string">&quot;조회수 초기값 확인&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">void</span> <span class="token function">initValueOfVisits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">assertThat</span><span class="token punctuation">(</span>question<span class="token punctuation">.</span><span class="token function">getVisits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getVisitCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token number">0L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@DisplayName</span><span class="token punctuation">(</span><span class="token string">&quot;조회수 증가&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">void</span> <span class="token function">increaseVisits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    question<span class="token punctuation">.</span><span class="token function">increaseVisits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assertThat</span><span class="token punctuation">(</span>question<span class="token punctuation">.</span><span class="token function">getVisits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getVisitCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="service-계층"><a href="#service-계층" class="header-anchor">#</a> - Service 계층</h4> <ul><li>실질적인 비즈니스 로직을 수행</li> <li>실제 데이터베이스 사용</li> <li>트랜잭션이 끝나면 데이터베이스 상태 변경</li> <li>테스트 간 격리가 필요</li> <li>실제 데이터베이스를 사용하면서 계층구조로 이루어져있기 때문에 사실상 통합 테스트가 되버림</li> <li>@Transactional을 사용해서 테스트가 종료되면 rollback가능</li> <li>Mockito를 이용하면 실제 데이터베이스를 사용하지 않기 때문에 테스트 격리를 고민할 필요가 없다.</li></ul> <h4 id="controller-계층"><a href="#controller-계층" class="header-anchor">#</a> - Controller 계층</h4> <ul><li>@SpringBootTest
<ul><li>Spring IoC로 실제 컨트롤러 빈을 사용해서 테스트</li> <li>실제 데이터베이스 사용</li> <li>통합 테스트</li></ul></li> <li>@WebMvcTest
<ul><li>MockMvc RestAPI 클라이언트 테스트 도구 사용</li> <li>데이터베이스를 사용하지 않고 단위 테스트 수행</li></ul></li></ul> <h4 id="repository-계층"><a href="#repository-계층" class="header-anchor">#</a> - Repository 계층</h4> <ul><li>@DataJpaTest
<ul><li>Slice Test 진행</li> <li>In Memory로 테스트 수행</li> <li>자동으로 @Transactional(rollback=true)이 사용됨</li></ul></li></ul> <h3 id="인수-테스트"><a href="#인수-테스트" class="header-anchor">#</a> 인수 테스트</h3> <ul><li>시스템이 실제 운영 환경에서 사용될 준비가 되었는지 최종적으로 확인하는 단계</li> <li>실제 운영환경에 맞게 서버를 띄우고 데이터베이스를 사용</li> <li>테스트 격리를 신경쓰지 않으면 테스트가 실패하기 쉬움</li> <li>테스트 단위가 커서 한번 실패하면 디버깅하기 까다로움</li> <li>Mock 객체가 아닌 실제 빈을 사용</li></ul> <h4 id="인수테스트-방법"><a href="#인수테스트-방법" class="header-anchor">#</a> 인수테스트 방법</h4> <ol><li><p>@Transactional : 인수 테스트에서 제대로 작동하지 않음. 요청을 보내는 http client 쪽과 실제 로직을 수행하는 서버로직이 서로 다른 쓰레드에서 실행된다. 테스트 코드에서 어노테이션을 롤백 전략으로 해두어도, 다른 스레드에서 실행되는 서버 사이드 트랜잭션은 그 테스트 코드의 영향을 받지 않고 데이터베이스가 변하게 된다.
<img src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&amp;fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FRU1t0%2FbtqUBvdOrYi%2Fw2kwi1Q5BZ7IWdNOKpQPa1%2Fimg.png" alt="image"></p></li> <li><p>매번 테스트 종료시 생성한 픽스처 및 데이터 삭제
<img src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&amp;fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FdnPh4v%2FbtqUtWqaFlR%2FKRtQQHcO9GKB2uDLfmNVn1%2Fimg.png" alt="image"></p></li> <li><p>매번 테스트 종료시 테이블 Truncate</p></li></ol> <ul><li><p>Delete보다 Truncate가 좋은 이유</p> <ul><li>트랜잭션 로그 공간을 적게 차지</li> <li>쿼리 실행시 행단위로 락을 걸지 않음</li></ul></li> <li><p>3-1 @Sql로 SQL 파일 실행
<img src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&amp;fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FcIsYKn%2FbtqUuNmfBa6%2FfkYV5NnPOrydLHdzscl761%2Fimg.png" alt="image"></p></li> <li><p><code>3-2 EntityManager 이용</code>(보스독님이 추천하는 방식)
엔티티 매니저로 쿼리를 직접 만들어서 실행하는 방식. 엔티티에 있는 테이블 이름을 가지고온 후 리스트에 저장
<img src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&amp;fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FM127C%2FbtqUBvESPMW%2FEAMBpFpIQjbK6k3wATWgQK%2Fimg.png" alt="image"></p></li></ul> <p>데이터 베이스를 주입 받고 테스트를 실행하기 직전 @BeforeEach에서 테이블 이름을 조사한 후 Truncate를 실행. 이렇게 만들어 두면 추후 엔티티가 추가되거나 삭제될 때 동적으로 테이블을 조사하기 때문에 테스트 격리에 투입되는 비용을 줄일 수 있음</p> <p><img src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&amp;fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FOo8nJ%2FbtqUvDKsjGT%2FDan2LsPFp9BJhaGHkokmKk%2Fimg.png" alt="image"></p> <h3 id="정리"><a href="#정리" class="header-anchor">#</a> 정리</h3> <ul><li>잘격리된 테스트는 유지보수가 수월</li> <li>더욱 안전한 테스트 작성으로 코드의 품질 보장</li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/TIL/2022/0523.html" class="prev">
        0523 ~ 0605
      </a></span> <span class="next"><a href="/TIL/2022/0627.html">
        0627 ~ 0703
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/TIL/assets/js/app.30a336f9.js" defer></script><script src="/TIL/assets/js/2.4f3b10d1.js" defer></script><script src="/TIL/assets/js/64.5042f020.js" defer></script>
  </body>
</html>
