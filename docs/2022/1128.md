# 1128 ~ 1204

## 1201 - Spring REST Docs + Rest Assured
**[ build.gradle ]**  

```gradle
plugins {
    ...
    // Asciidoctor 플러그인을 적용
    id "org.asciidoctor.jvm.convert" version "3.3.2"
    ...
}

configurations {
    ...
    // asciidoctorExtAsciidoctor를 확장하는 종속성에 대한 구성을 선언
    asciidoctorExt
    ...
}

dependencies {
    ...
    // asciidoctorExt : spring-restdocs-asciidoctor 구성 의존성을 추가
    // snippets을 .adoc로 가리키고 build/generated-snippets 생성되도록 자동으로 구성 
    asciidoctorExt 'org.springframework.restdocs:spring-restdocs-asciidoctor'
    // spring-restdocs-restassured 의존성을 추가
    testImplementation 'org.springframework.restdocs:spring-restdocs-restassured'
    ...
}

ext {
    ...
    // 생성된 스니펫의 출력 위치를 정의하도록 속성을 구성
    set('snippetsDir', file("build/generated-snippets"))
    ...
}

tasks.named('test') {
    outputs.dir snippetsDir
    useJUnitPlatform()
}


tasks.named('asciidoctor') {
    inputs.dir snippetsDir
    // 	asciidoctorExt확장 에 대한 구성 사용을 구성
    configurations 'asciidoctorExt'
    dependsOn test
}

tasks.named('bootJar') {
    dependsOn asciidoctor
    // 생성된 문서를 jar static/docs디렉토리에 복사
    from("${asciidoctor.outputDir}/html5") {
        into '${sourceSets.main.output.resourcesDir}/static/docs'
    }
}
```

**[ 테스트 클래스 ]** 

- AcceptanceTest
```java
@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT)
@ExtendWith({RestDocumentationExtension.class, SpringExtension.class})
public class AcceptanceTest {

    @LocalServerPort
    int port;

    protected RequestSpecification spec;

    @BeforeEach
    public void setUp(RestDocumentationContextProvider restDocumentation) {
        RestAssured.port = port;
        this.spec = new RequestSpecBuilder()
                .addFilter(documentationConfiguration(restDocumentation))
                .build();
    }

}
```

- OrderRestControllerTest
```java
class OrderRestControllerTest extends AcceptanceTest {

    @Test
    void postOrder() {
        // given
        String menuName = "메뉴";

        // when
        ExtractableResponse<Response> response = 주문_생성_요청(menuName, 2);
        OrderModel order = response.as(OrderModel.class);

        // then
        assertThat(response.statusCode()).isEqualTo(HttpStatus.OK.value());
        assertThat(order.getMenuName()).isEqualTo(menuName);
    }

    private ExtractableResponse<Response> 주문_생성_요청(String menuName, Integer quantity) {
        OrderPostRequestDTO dto = new OrderPostRequestDTO(menuName, quantity);

        return RestAssured
                .given()

                .spec(this.spec)
                .accept(APPLICATION_JSON_VALUE)
                .filter(document("post-order",
                        requestFields(
                                fieldWithPath("order.menuName").type(STRING).description("order menu name"),
                                fieldWithPath("order.quantity").type(NUMBER).description("order quantity")),
                        responseFields(
                                fieldWithPath("order.menuName").type(STRING).description("order menu name"),
                                fieldWithPath("order.quantity").type(NUMBER).description("order quantity"))
                ))
                .log().all()
                .body(dto)
                .contentType(APPLICATION_JSON_VALUE)
                .when().post("/orders")
                .then().log().all()
                .extract();
    }
}
```

**[ adoc 문서 작성 ]**  

- common.adoc
```adoc
[[index]]
=== link:./index-docs.html[HOME]

[[common]]
== Common API Docs

=== HTTP Status Code
[cols="2,3,5"]
|===
| Code | Description | Constraint

| 200
| Success
|

| 400
| Bad Request
|
|===
```

- order.adoc
```adoc
= Order API
:doctype: book
:icons: font
:source-highlighter: highlightjs
:toc: left
:toclevels: 3
:sectlinks:

include::common.adoc[]

== Order API Docs

=== POST /orders
Curl Request
include::{snippets}/post-order/curl-request.adoc[]

Request Headers

Path Parameters

Request Parameters

Request Fields
include::{snippets}/post-order/request-fields.adoc[]

Response Fields
include::{snippets}/post-order/response-fields.adoc[]

HTTP Request
include::{snippets}/post-order/http-request.adoc[]

HTTP Response
include::{snippets}/post-order/http-response.adoc[]
```

<br>

## 1203 - 
### 